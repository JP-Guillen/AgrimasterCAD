@page "/Account/Manage/PersonalData"

@using Microsoft.AspNetCore.Identity
@using AgrimasterCAD.Data

@inject UserManager<ApplicationUser> UserManager
@inject IdentityRedirectManager RedirectManager

<PageTitle>Datos Personales</PageTitle>

<div class="container px-5 py-5">
    <div class="row justify-content-center">

        <div class="col-md-7 col-lg-6">

            <div class="card shadow border-0 rounded-4">
                <div class="card-body p-5">

                    <h2 class="fw-bolder text-center mb-4">Datos Personales</h2>

                    <p class="text-muted">
                        Tu cuenta contiene datos personales que nos has proporcionado.  
                        Puedes descargar una copia o eliminarla definitivamente.
                    </p>

                    <div class="alert alert-warning mt-3">
                        <b>Advertencia:</b> Eliminar esta información cerrará tu cuenta de forma permanente.
                    </div>

                    <div class="d-flex justify-content-between mt-4">

                        <form action="/Account/Manage/DownloadPersonalData" method="post">
                            <AntiforgeryToken />
                            <button class="btn btn-primary fw-bold" type="submit">
                                Descargar datos
                            </button>
                        </form>

                        <a href="/Account/Manage/DeletePersonalData" class="btn btn-danger fw-bold">
                            Eliminar cuenta
                        </a>

                    </div>

                </div>
            </div>

        </div>

    </div>
</div>

@code {
    [CascadingParameter] private HttpContext HttpContext { get; set; } = default!;

    protected override async Task OnInitializedAsync()
    {
        var user = await UserManager.GetUserAsync(HttpContext.User);
        if (user is null)
        {
            RedirectManager.RedirectToInvalidUser(UserManager, HttpContext);
        }
    }
}
